<% content_for(:title) { "Organization Stats - Page Migration" } %>

<div class="space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-3xl font-bold text-wttj-black">Organization Stats</h1>
    <%= link_to "Export CSV", stats_path(format: :csv, size: @size),
        class: "bg-wttj-yellow hover:bg-yellow-400 text-wttj-black font-semibold px-4 py-2 rounded-lg transition-colors" %>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow-sm border border-wttj-gray-light p-6">
    <%= form_with url: stats_path, method: :get, class: "flex flex-wrap gap-4 items-end", data: { turbo_frame: "_top" } do |f| %>
      <div>
        <label class="block text-sm font-medium text-wttj-gray-dark mb-1">Size Category</label>
        <%= f.select :size,
            options_for_select([["All sizes", ""], ["Big (>10 pages)", "big"], ["Medium (3-10 pages)", "medium"], ["Small (0-2 pages)", "small"]], @size),
            {},
            class: "px-4 py-2 rounded-lg border border-wttj-gray-light focus:border-wttj-yellow focus:ring-2 focus:ring-wttj-yellow focus:ring-opacity-50 outline-none" %>
      </div>
      <%= f.submit "Filter",
          class: "bg-wttj-yellow hover:bg-yellow-400 text-wttj-black font-semibold px-6 py-2 rounded-lg transition-colors cursor-pointer" %>
    <% end %>
  </div>

  <!-- Summary -->
  <div class="grid grid-cols-4 gap-4">
    <div class="bg-white rounded-lg shadow-sm border border-wttj-gray-light p-4 text-center">
      <div class="text-3xl font-bold text-wttj-black"><%= @summary[:total] %></div>
      <div class="text-sm text-wttj-gray-dark">Total</div>
    </div>
    <% %w[big medium small].each do |size| %>
      <div class="bg-white rounded-lg shadow-sm border border-wttj-gray-light p-4 text-center">
        <div class="text-3xl font-bold <%= OrganizationStatPresenter.summary_color(size) %>"><%= @summary[size.to_sym] %></div>
        <div class="text-sm text-wttj-gray-dark"><%= size.capitalize %></div>
      </div>
    <% end %>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-lg shadow-sm border border-wttj-gray-light overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-wttj-beige border-b border-wttj-gray-light">
          <tr>
            <th class="px-4 py-3 text-left text-sm font-semibold text-wttj-black">Reference</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-wttj-black">Name</th>
            <th class="px-4 py-3 text-right text-sm font-semibold text-wttj-black">Total</th>
            <th class="px-4 py-3 text-right text-sm font-semibold text-wttj-black">Published</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-wttj-black">Last Published</th>
            <th class="px-4 py-3 text-center text-sm font-semibold text-wttj-black">Size</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-wttj-gray-light">
          <% @stats.each do |stat| %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3">
                <%= link_to stat.reference, organization_path(stat.reference),
                    class: "font-mono text-sm text-wttj-black hover:text-wttj-yellow" %>
              </td>
              <td class="px-4 py-3 text-wttj-black max-w-xs truncate" title="<%= stat.name %>">
                <%= stat.truncated_name %>
              </td>
              <td class="px-4 py-3 text-right font-mono text-sm"><%= stat.total_pages %></td>
              <td class="px-4 py-3 text-right font-mono text-sm"><%= stat.published_pages %></td>
              <td class="px-4 py-3 text-sm text-wttj-gray-dark">
                <%= stat.formatted_published_date || content_tag(:span, "-", class: "text-wttj-gray-medium") %>
              </td>
              <td class="px-4 py-3 text-center">
                <span class="inline-block px-2 py-1 text-xs font-medium rounded <%= stat.size_badge_classes %>">
                  <%= stat.size_category %>
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <% if @stats.empty? %>
      <div class="p-8 text-center text-wttj-gray-dark">
        No organizations found
      </div>
    <% end %>

    <%= render "shared/pagination" %>
  </div>
</div>
